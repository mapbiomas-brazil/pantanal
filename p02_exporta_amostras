 var col6_r1 = 
    /* color: #d68b26 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-55.829473998154924, -20.44969628194268],
          [-55.532724612421674, -20.029411251326657],
          [-55.28913891501071, -19.688340994555517],
          [-55.6002771302108, -19.626431916779925],
          [-55.86517289150303, -19.636953339526592],
          [-56.171654304016506, -19.55957233811776],
          [-56.233199080222555, -19.70422843564422],
          [-56.441914605579235, -19.647335778535272],
          [-56.854751377888185, -19.784369981567128],
          [-57.332630158721614, -19.621453250312157],
          [-57.452931866851685, -19.825620399852284],
          [-57.82122228751098, -20.137955092876624],
          [-57.79959438100805, -20.292571036315522],
          [-57.349114375835924, -20.199885192099366],
          [-57.40404201520423, -20.441978807580252],
          [-57.590796622808085, -20.555168810746757],
          [-57.728116029018324, -20.663135628558187],
          [-57.887405730023126, -21.012213927689917],
          [-57.91211607434659, -21.114728823406807],
          [-57.984862793183545, -21.54109854640506],
          [-58.02746329939637, -22.120676972342537],
          [-57.78994600356089, -22.15908284375699],
          [-57.511147015357395, -22.166459680602365],
          [-57.43975356413684, -21.748730008196915],
          [-57.233553712422356, -21.489337456789443],
          [-57.225349933437656, -21.288016700639623],
          [-57.09221276497816, -21.24108554396522],
          [-57.079968989331064, -21.1992431802257],
          [-57.10743946456208, -21.104480151261242],
          [-57.112927958757645, -20.65285214190624],
          [-56.89575867955908, -20.57574422154054],
          [-56.943833687477955, -20.22536877941848],
          [-57.06854800973943, -20.101664120926113],
          [-57.30106722835741, -20.044913145289836],
          [-57.23327463608028, -19.941941832764016],
          [-56.94993230982704, -19.824090333171224],
          [-56.78181300331245, -20.016740830925674],
          [-56.72770779903858, -20.136604616270702],
          [-56.64824753913202, -20.191062602800443],
          [-56.711603648603486, -20.25067577202293],
          [-56.689977991264726, -20.369898484279663],
          [-56.60553698163289, -20.373988535326358],
          [-56.541857322987106, -20.302901039544732],
          [-56.456191562565316, -20.40174713300477],
          [-56.383717943290605, -20.419138255623498],
          [-56.352574118118056, -20.31413703246879],
          [-56.364470706669906, -19.96763959464227],
          [-56.272044369466286, -20.131848991832555],
          [-56.09742727255365, -20.18207501754346],
          [-56.03359214127575, -20.43682562388033]]]),
    col6_r2 = 
    /* color: #b51630 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-54.92983371423221, -16.433463949781295],
          [-55.39675265954471, -16.628309994594183],
          [-55.58352023766971, -16.757221009272502],
          [-55.73732883141971, -16.75196103955729],
          [-55.94057590173221, -16.699353354590976],
          [-56.11352910927068, -16.767791727594265],
          [-56.28664523766971, -16.878160102381326],
          [-56.53109103845096, -17.25624939527688],
          [-56.93171937436206, -17.363788394413582],
          [-56.75940430790553, -17.471140106962906],
          [-56.949649943271865, -17.60468924988467],
          [-57.12160617516971, -17.777471757798033],
          [-57.22048312829473, -17.981327807351636],
          [-57.18752414391971, -17.997032462863395],
          [-57.11963366928438, -18.061733322644745],
          [-57.0407159448067, -18.095070221540244],
          [-56.702752415404085, -18.191533564117826],
          [-56.41848117516971, -18.124983657395948],
          [-56.00374728845096, -18.221537964082593],
          [-55.80873996423221, -18.185010184846984],
          [-55.77578097985721, -18.229364348611494],
          [-56.67665988610721, -18.354538529959118],
          [-56.90927936950233, -18.36944004556459],
          [-57.09803429168497, -18.42060051180717],
          [-57.25049822185872, -18.50707773240779],
          [-57.17104465173221, -18.62804023556031],
          [-57.24520236657596, -18.932281467976644],
          [-57.06118137048221, -18.99981578048445],
          [-56.87716037438846, -18.958259440643616],
          [-56.56130344079471, -18.93747738591735],
          [-56.432347234232516, -19.018246720864827],
          [-55.92958957360721, -19.077705937225122],
          [-55.84169894860721, -19.064726782910462],
          [-55.74282199548221, -19.093279580229122],
          [-55.85817844079471, -19.16853151536531],
          [-55.83071262048221, -19.337074726027154],
          [-56.16030246423221, -19.422576378850508],
          [-56.16030246423221, -19.570155046682178],
          [-56.17128879235721, -19.611556406894678],
          [-55.946221156342844, -19.671549850710992],
          [-55.62210154191919, -19.659936521207317],
          [-55.31435519860721, -19.725355141981474],
          [-55.16603976891971, -19.466605146877882],
          [-54.841038042793215, -18.486132991196897],
          [-54.75405246423221, -17.999644642211894],
          [-54.84205308927474, -17.879206809834944],
          [-54.92983371423221, -17.507880159599758],
          [-54.894111068710096, -17.1325298490954],
          [-54.90236789391971, -16.720398170243843]]]),
    col6_r3 = 
    /* color: #2ee662 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-57.57465721504674, -16.101250030528462],
          [-57.56641746895299, -16.029988521988372],
          [-57.554061653030786, -15.98725912642916],
          [-57.50105937169362, -15.865590919258377],
          [-57.46975577464328, -15.809632334613847],
          [-57.4334589506958, -15.768774252938355],
          [-57.73409175991967, -15.596887534865436],
          [-57.96741844551549, -15.638920054156486],
          [-58.12366829776988, -15.92208955685078],
          [-58.127184830518196, -16.35682825150403],
          [-58.21695005822386, -16.389335545043718],
          [-58.23431841714056, -15.978254002434946],
          [-58.33942110373306, -15.883885731887231],
          [-58.4509418467734, -15.921801150119776],
          [-58.48477351944274, -16.157183821574456],
          [-58.67249649412721, -16.160315511601418],
          [-58.75294090645299, -15.908521410229147],
          [-58.93948092262497, -16.05383265158923],
          [-59.16492821114049, -16.161934110122967],
          [-59.14295555489049, -16.320152598876277],
          [-58.40687157051549, -16.36232265316303],
          [-58.46729637520299, -16.709876052479927],
          [-58.33546043770299, -16.809812703090078],
          [-58.12946678535924, -16.83347421108664],
          [-57.81360985176549, -16.700668723541646],
          [-57.71455907371132, -16.433449210375723],
          [-57.68452049629674, -16.322788493788362],
          [-57.62670160423009, -16.24095989488559]]]),
    col6_r5 = 
    /* color: #00ffff */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-57.70182810417243, -19.580603043063117],
          [-57.28984079948493, -19.37863245673745],
          [-57.52055369010993, -18.71400459754232],
          [-57.34477244010993, -18.255547181020336],
          [-57.67985544792243, -17.51845508310795],
          [-57.82542429557868, -17.561666663357386],
          [-57.7294471986304, -17.84596953412538],
          [-57.56587229362555, -18.198154158969405],
          [-57.815591812859296, -18.974746844015122],
          [-58.02867136589118, -19.512013089456957],
          [-57.93803415885993, -19.55472346682458]]]),
    col6_r4 = 
    /* color: #d627e6 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-56.97847372500667, -17.607306195633942],
          [-56.67907165776617, -17.426592639967925],
          [-56.46487980448333, -17.376798496919086],
          [-56.212209641458465, -17.237838441942067],
          [-56.03913414969145, -17.177566885208893],
          [-55.78103402313747, -16.92543801235744],
          [-55.61352287186958, -16.788748279342805],
          [-55.39092483095186, -16.63907397485274],
          [-55.297739062055584, -16.599354450300094],
          [-55.27027544446755, -16.525662565790714],
          [-55.24292301427823, -16.48369399838013],
          [-55.44050820161536, -16.15933714057278],
          [-55.86679236955985, -15.702611532713489],
          [-56.025461777161574, -15.70776104842358],
          [-56.1747630606758, -15.793897588210882],
          [-56.23850631341784, -15.984809741339138],
          [-56.47813257513224, -15.953785762408506],
          [-56.630607593401, -16.102793478599498],
          [-56.657549658830774, -16.26161331179389],
          [-56.81639384573609, -16.272725996048372],
          [-56.85628685383659, -16.121140620806834],
          [-56.94563016907179, -16.06970055271217],
          [-57.14608552299651, -15.850474128293106],
          [-57.29438452342019, -15.998365461137572],
          [-57.453667707804556, -16.235817864844552],
          [-57.45915694937658, -16.42557123098809],
          [-57.29711191099496, -16.554596018884816],
          [-57.12550646662166, -16.610514941325086],
          [-57.29166831885534, -16.81109289179452],
          [-57.27240713891418, -16.84395550403289],
          [-57.27793045421736, -16.917549418830472],
          [-57.3026852706046, -17.05408763980502],
          [-57.269535288869726, -17.43685268808063],
          [-57.16801816573325, -17.616397106024582]]]),
    col6_r6 = 
    /* color: #257e85 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-57.21342301481497, -17.997709822963408],
          [-57.14475846403372, -17.864437991826268],
          [-56.96623063200247, -17.869666226031434],
          [-56.95249772184622, -17.835679956125205],
          [-57.07609391325247, -17.809532256337143],
          [-56.945631266768096, -17.630972081046753],
          [-56.56248307340872, -17.393271986278307],
          [-56.63664078825247, -17.382787702792452],
          [-56.78495621793997, -17.411618036200245],
          [-56.90031266325247, -17.374924096008215],
          [-56.726379866450934, -17.30972166892133],
          [-56.12852311247122, -17.17297632609386],
          [-56.12852311247122, -17.133610153075686],
          [-56.24935783226769, -17.12448730823316],
          [-56.45261979215872, -17.167727985494327],
          [-56.27409196012747, -16.89723856539859],
          [-56.14774918668997, -16.79208910682224],
          [-56.19634557316129, -16.7842991994483],
          [-56.4606902947133, -16.96304437883555],
          [-56.65861344450247, -17.041723345245334],
          [-56.79044938200247, -17.002329437819075],
          [-56.74925065153372, -16.913005938977363],
          [-56.21641373747122, -16.668464065949756],
          [-56.35923600309622, -16.476292435739694],
          [-56.61192154997122, -16.56318829447679],
          [-56.88383317106497, -16.834155900025806],
          [-56.93327164762747, -16.707927574063252],
          [-57.01566910856497, -16.707927574063252],
          [-57.04588151090872, -16.73949250821188],
          [-57.26011490934622, -16.82364007682041],
          [-57.08158707731497, -16.613201482998086],
          [-57.18046403043997, -16.499995181307273],
          [-57.25736832731497, -16.539493301654183],
          [-57.28483414762747, -16.492094588623985],
          [-57.36997819059622, -16.436781416074812],
          [-57.42216324918997, -16.4321712730822],
          [-57.453748942549346, -16.413070944081234],
          [-57.48533463590872, -16.516453712825367],
          [-57.609617472822784, -16.576350920454964],
          [-57.67690873258841, -16.619123235753058],
          [-57.775099040205596, -16.59740924968809],
          [-57.821790934736846, -16.65399207251893],
          [-57.821790934736846, -16.61846527224456],
          [-57.821790934736846, -16.586880373244124],
          [-57.79020524137747, -16.552657546095983],
          [-57.777845622236846, -16.497361686260373],
          [-57.79569840543997, -16.46575695091045],
          [-57.97422623747122, -16.32083610828229],
          [-58.03465104215872, -16.315564230354365],
          [-58.10537552946341, -16.726998679918616],
          [-58.31136918180716, -16.766778809465052],
          [-58.27635026090872, -16.600041378707164],
          [-58.22691178434622, -16.600041378707164],
          [-58.21867203825247, -16.531594323783985],
          [-58.25987076872122, -16.536860344954402],
          [-58.33128190153372, -16.492094588623985],
          [-58.44663834684622, -16.513162118625885],
          [-58.50706315153372, -16.6500449753938],
          [-58.50706315153372, -16.983942778429757],
          [-58.33677506559622, -17.356574367087067],
          [-57.86161637418997, -17.60544899664405],
          [-57.68034196012747, -17.801687198553825],
          [-57.55949235075247, -18.10216636532389]]]),
    col6_r7 = 
    /* color: #ff0000 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-57.536412376976756, -18.244591753599884],
          [-57.486973900414256, -18.294146328803823],
          [-57.591344017601756, -18.707026505695946],
          [-57.742406029320506, -18.730438229690048],
          [-57.797337669945506, -18.938399501899948],
          [-57.583104271508006, -19.008528167728887],
          [-57.522679466820506, -19.063052255541646],
          [-57.511693138695506, -19.130533430846082],
          [-57.530919212914256, -19.192799288945622],
          [-57.47530092678144, -19.21484613741784],
          [-57.42491952648797, -19.22603070243386],
          [-57.428779035921735, -19.243695758132233],
          [-57.49830355129316, -19.262172026503357],
          [-57.49727358303144, -19.281292999241902],
          [-57.333165306664256, -19.358726289620396],
          [-57.440282005883006, -19.449396358352374],
          [-57.690220970726756, -19.5296618505311],
          [-58.019810814476756, -19.470113842435705],
          [-58.195592064476756, -19.79864764061466],
          [-58.176365990258006, -20.24766414952094],
          [-58.159886498070506, -20.31207223391828],
          [-57.962132591820506, -20.867435054803522],
          [-57.887974876976756, -21.00082983957074],
          [-57.712193626976756, -20.80839568151116],
          [-57.627049584008006, -20.628568544049173],
          [-57.492467064476756, -20.564292935974144],
          [-57.399083275414256, -20.53600309078867],
          [-57.407323021508006, -20.461395701235382],
          [-57.319432396508006, -20.252817780452848],
          [-57.503453392601756, -19.979440549366284],
          [-57.599583763695506, -20.085237432419962],
          [-57.649022240258006, -20.219316123741166],
          [-57.780858177758006, -20.278583368855713],
          [-57.816563744164256, -20.147134212217406],
          [-57.451268334008006, -19.84257345257275],
          [-57.333165306664256, -19.633171303573263],
          [-56.962376732445506, -19.772803261649162],
          [-56.728917259789256, -20.051699793107698],
          [-56.577855248070506, -20.072339189141285],
          [-56.498204369164256, -20.134241069948153],
          [-56.484471459008006, -20.00267035453017],
          [-56.470738548851756, -19.91489535438888],
          [-56.544896263695506, -19.870989564369204],
          [-56.544896263695506, -19.83482272085156],
          [-56.500950951195506, -19.775387888235535],
          [-56.446019310570506, -19.785725975346654],
          [-56.371861595726756, -19.883904295666465],
          [-56.314183373070506, -19.84257345257275],
          [-56.149388451195506, -19.5736614949323],
          [-56.152135033226756, -19.441626619607668],
          [-55.833531517601756, -19.340586216604407],
          [-55.847264427758006, -19.174640843033632],
          [-55.734654564476756, -19.096796282753306],
          [-55.847264427758006, -19.052668095567615],
          [-55.929661888695506, -19.068244091684157],
          [-56.435032982445506, -18.992946570857388],
          [-56.555882591820506, -18.917614975232325],
          [-56.713111171622224, -18.93977559648609],
          [-56.896458763695506, -18.94359522947947],
          [-57.061253685570506, -18.985155225378243],
          [-57.226048607445506, -18.933203612647766],
          [-57.160130638695506, -18.641976951015554],
          [-57.22518147912456, -18.52296611104089],
          [-57.220178678521194, -18.497148424613812],
          [-57.09024158717129, -18.43353673819188],
          [-56.89169493841206, -18.378317188868156],
          [-56.690465111351756, -18.37892377297213],
          [-56.544896263695506, -18.347643123424692],
          [-56.310619065337264, -18.338898465817497],
          [-55.770360130883006, -18.230290304334925],
          [-55.811558861351756, -18.178108040761597],
          [-56.003819603539256, -18.212028290139475],
          [-56.404820580101756, -18.120689522755757],
          [-56.695958275414256, -18.18332697020688],
          [-57.039281029320506, -18.084140655081907],
          [-57.1196431990464, -18.047592890893],
          [-57.201329369164256, -17.97706093023734],
          [-57.555638451195506, -18.095889336482557]]]);
var versao_out = '1'
var versao_estavel = '1'


var dirout = 'projects/mapbiomas-workspace/AMOSTRAS/col7/PANTANAL/SAMPLES/';

var biomes = ee.Image('projects/mapbiomas-workspace/AUXILIAR/biomas-raster-41')
var bioma250mil_PANT = biomes.mask(biomes.eq(3))
Map.addLayer(bioma250mil_PANT)

var palettes = require('users/mapbiomas/modules:Palettes.js');
var vis = {
    'min': 0,
    'max': 45,
    'palette': palettes.get('classification5')
};

var mapa_estavel_col6 = ee.Image('projects/mapbiomas-workspace/AMOSTRAS/col6/PANTANAL/PANT_amostras_estaveis85a20_col6_v'+versao_estavel)
Map.addLayer(mapa_estavel_col6, vis, 'mapa_estavel_col5', false);

var regioes = [col6_r1,col6_r2,col6_r3,col6_r4,col6_r5,col6_r6,col6_r7]
// var regioes = [col6_r1]

 var GEDI = ee.Image('users/potapovpeter/GEDI_V27/GEDI_SAM_v27').mask(biomes.eq(3)).rename('GEDI');
  // print("GEDI",GEDI);
  
  var imageVisGEDI = {"min": 0,"max": 15,"palette":["c9f5f1","#ffbeee","#daffe0","#c0debf","08ff04","#037e07","0b240a"]};
  Map.addLayer(GEDI, imageVisGEDI,'GEDI', false);
 
for (var id in regioes){
  var reg_id = parseInt(id) + 1
  print(reg_id)
  var regiao = regioes[id];
  
  var training_estavel = mapa_estavel_col6.stratifiedSample({
    'numPoints': 0,
    'classBand': 'reference',
    'region': regiao,
    'classValues': [   3,   4,   12,   21,   33],
    'classPoints': [4000,7000, 3000, 3000, 3000],
    'scale': 30, 
    'seed': 1, 
    'geometries': true
  })
  
  
  
 
   GEDI = GEDI.clip(regiao).rename('GEDI');
  // print("GEDI",GEDI);
  
 
  
  var am_flo = training_estavel.filterMetadata('reference','equals',3)
  var am_flo_gedi = GEDI.sampleRegions({"collection": am_flo, "properties": ['reference'], "scale": 30, "geometries": true})
  am_flo_gedi = am_flo_gedi.filterMetadata('GEDI','greater_than',7)
  print('am_flo_gedi',am_flo_gedi.size())
  // Map.addLayer(am_flo, {},'am_flo', false);
  // Map.addLayer(am_flo_gedi, {},'am_flo_gedi', false);
  
  var am_sav = training_estavel.filterMetadata('reference','equals',4)
  var am_sav_gedi = GEDI.sampleRegions({"collection": am_sav, "properties": ['reference'], "scale": 30, "geometries": true})
  am_sav_gedi = am_sav_gedi.filterMetadata('GEDI','greater_than',3).filterMetadata('GEDI','less_than',6)
  print('am_sav_gedi',am_sav_gedi.size())
  // Map.addLayer(am_sav, {},'am_sav', false);
  // Map.addLayer(am_sav_gedi, {},'am_sav_gedi', false);
  
  var am_cam = training_estavel.filterMetadata('reference','equals',12)
  var am_cam_gedi = GEDI.sampleRegions({"collection": am_cam, "properties": ['reference'], "scale": 30, "geometries": true})
  am_cam_gedi = am_cam_gedi.filterMetadata('GEDI','less_than',2)
  print('am_cam_gedi',am_cam_gedi.size())
  // Map.addLayer(am_cam, {},'am_cam', false);
  // Map.addLayer(am_cam_gedi, {},'am_cam_gedi', false);
  
  var am_agr = training_estavel.filterMetadata('reference','equals',21)
  var am_agr_gedi = GEDI.sampleRegions({"collection": am_agr, "properties": ['reference'], "scale": 30, "geometries": true})
  am_agr_gedi = am_agr_gedi.filterMetadata('GEDI','less_than',2)
  print('am_agr_gedi',am_agr_gedi.size())
  // Map.addLayer(am_agr, {},'am_agr', false);
  // Map.addLayer(am_agr_gedi, {},'am_agr_gedi', false);
  
  var am_agu = training_estavel.filterMetadata('reference','equals',33)
  var am_agu_gedi = GEDI.sampleRegions({"collection": am_agu, "properties": ['reference'], "scale": 30, "geometries": true})
  am_agu_gedi = am_agu_gedi.filterMetadata('GEDI','less_than',1)
  print('am_agu_gedi',am_agu_gedi.size())
  // Map.addLayer(am_agu, {},'am_agu', false);
  // Map.addLayer(am_agu_gedi, {},'am_agu_gedi', false);
  
  
  var amostras_final = am_flo_gedi.merge(am_sav_gedi).merge(am_cam_gedi).merge(am_agr_gedi).merge(am_agu_gedi)
  
  Export.table.toAsset(amostras_final, 'samples_stable_r'+reg_id+'_v'+versao_out, dirout+ 'samples_stable_r'+reg_id+'_v'+versao_out);
}

